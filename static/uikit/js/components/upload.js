/*! For license information please see upload.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("uikit-util")):"function"==typeof define&&define.amd?define("uikitupload",["uikit-util"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).UIkitUpload=t(e.UIkit.util)}(this,(function(e){"use strict";var t={mixins:[{props:{i18n:Object},data:{i18n:null},methods:{t(e,...t){var i,o,r;let n=0;return(null==(r=(null==(i=this.i18n)?void 0:i[e])||(null==(o=this.$options.i18n)?void 0:o[e]))?void 0:r.replace(/%s/g,(()=>t[n++]||"")))||""}}}],i18n:{invalidMime:"Invalid File Type: %s",invalidName:"Invalid File Name: %s",invalidSize:"Invalid File Size: %s Kilobytes Max"},props:{allow:String,clsDragover:String,concurrent:Number,maxSize:Number,method:String,mime:String,multiple:Boolean,name:String,params:Object,type:String,url:String},data:{allow:!1,clsDragover:"uk-dragover",concurrent:1,maxSize:0,method:"POST",mime:!1,multiple:!1,name:"files[]",params:{},type:"",url:"",abort:e.noop,beforeAll:e.noop,beforeSend:e.noop,complete:e.noop,completeAll:e.noop,error:e.noop,fail:e.noop,load:e.noop,loadEnd:e.noop,loadStart:e.noop,progress:e.noop},events:{change(t){e.matches(t.target,'input[type="file"]')&&(t.preventDefault(),t.target.files&&this.upload(t.target.files),t.target.value="")},drop(t){o(t);const i=t.dataTransfer;(null==i?void 0:i.files)&&(e.removeClass(this.$el,this.clsDragover),this.upload(i.files))},dragenter(e){o(e)},dragover(t){o(t),e.addClass(this.$el,this.clsDragover)},dragleave(t){o(t),e.removeClass(this.$el,this.clsDragover)}},methods:{async upload(t){if(!(t=e.toArray(t)).length)return;e.trigger(this.$el,"upload",[t]);for(const e of t){if(this.maxSize&&1e3*this.maxSize<e.size)return void this.fail(this.t("invalidSize",this.maxSize));if(this.allow&&!i(this.allow,e.name))return void this.fail(this.t("invalidName",this.allow));if(this.mime&&!i(this.mime,e.type))return void this.fail(this.t("invalidMime",this.mime))}this.multiple||(t=t.slice(0,1)),this.beforeAll(this,t);const o=function(e,t){const i=[];for(let o=0;o<e.length;o+=t)i.push(e.slice(o,o+t));return i}(t,this.concurrent),r=async t=>{const i=new FormData;t.forEach((e=>i.append(this.name,e)));for(const e in this.params)i.append(e,this.params[e]);try{const t=await function(t,i){const o={data:null,method:"GET",headers:{},xhr:new XMLHttpRequest,beforeSend:e.noop,responseType:"",...i};return Promise.resolve().then((()=>o.beforeSend(o))).then((()=>function(t,i){return new Promise(((o,r)=>{const{xhr:n}=i;for(const e in i)if(e in n)try{n[e]=i[e]}catch(e){}n.open(i.method.toUpperCase(),t);for(const e in i.headers)n.setRequestHeader(e,i.headers[e]);e.on(n,"load",(()=>{0===n.status||n.status>=200&&n.status<300||304===n.status?o(n):r(e.assign(Error(n.statusText),{xhr:n,status:n.status}))})),e.on(n,"error",(()=>r(e.assign(Error("Network Error"),{xhr:n})))),e.on(n,"timeout",(()=>r(e.assign(Error("Network Timeout"),{xhr:n})))),n.send(i.data)}))}(t,o)))}(this.url,{data:i,method:this.method,responseType:this.type,beforeSend:t=>{const{xhr:i}=t;e.on(i.upload,"progress",this.progress);for(const t of["loadStart","load","loadEnd","abort"])e.on(i,t.toLowerCase(),this[t]);return this.beforeSend(t)}});this.complete(t),o.length?await r(o.shift()):this.completeAll(t)}catch(e){this.error(e)}};await r(o.shift())}}};function i(e,t){return t.match(new RegExp(`^${e.replace(/\//g,"\\/").replace(/\*\*/g,"(\\/[^\\/]+)*").replace(/\*/g,"[^\\/]+").replace(/((?!\\))\?/g,"$1.")}$`,"i"))}function o(e){e.preventDefault(),e.stopPropagation()}return"undefined"!=typeof window&&window.UIkit&&window.UIkit.component("upload",t),t}));